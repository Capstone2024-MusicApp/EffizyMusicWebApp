@page "/course/add"
@using EffizyMusicSystem.Models
@using EffizyMusicSystem.Enum
@inject NavigationManager NavigationManager
@inject EffizyMusicSystem.Services.EffizyMusicApplicationService EffizyService
<h3>Add Course</h3>
<hr />
<EditForm Model="@model" OnValidSubmit="SaveCourse" FormName="addcourse">
    <DataAnnotationsValidator />
    <div class="mb-3">
        <label class="form-label">Course Title</label>
        <div class="col-md-4">
            <InputText class="form-control" @bind-Value="model.Title" />
        </div>
        <ValidationMessage For="@(() => model.Title)" />
    </div>
    <div class="mb-3">
        <label class="form-label">Course Code:</label>
        <div class="col-md-4">
            <InputText class="form-control" @bind-Value="model.CourseCode" />
        </div>
        <ValidationMessage For="@(() => model.CourseCode)" />
    </div>
    <div class="mb-3">
        <label class="form-label">Description:</label>
        <div class="col-md-4">
            <InputText class="form-control" @bind-Value="model.CourseDescription" />
        </div>
        <ValidationMessage For="@(() => model.CourseDescription)" />
    </div>
    

    <div class="mb-3">
        <label class="form-label">Select Instrument:</label>
        <div class="col-md-4">
            @* <select class="form-select" name="model.InstrumentID"> *@
            <InputSelect @bind-Value="model.InstrumentID" class="form-select" name="model.InstrumentID">
                @if (Instruments != null)
                {
                    <option value="">Select...</option>
                    foreach (var entity in Instruments)
                    {
                        <option value="@entity.InstrumentID">@entity.InstrumentType</option>
                    }
                }
            </InputSelect>
            <ValidationMessage For="@(() => model.InstrumentID)" />
            @* </select> *@
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Select Instructor:</label>
        <div class="col-md-4">
            @* <select class="form-select" name="model.InstructorID"> *@
            <InputSelect @bind-Value="model.InstructorID" class="form-select" name="model.InstructorID">
                @if (Instructors != null)
                {
                    <option value="">Select...</option>
                    foreach (var entity in Instructors)
                    {
                        <option value="@entity.InstructorID">@entity.FirstName @entity.LastName</option>
                    }
                }
            </InputSelect>
            <ValidationMessage For="@(() => model.InstructorID)" />
            @* </select> *@
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Skill Level </label>
        <div class="col-md-6">
            <InputSelect @bind-Value="model.SkillLevel" class="form-select" name="model.SkillLevel">
                <option value="">--Select an option--</option>
                <option value="Beginner">Beginner</option>
                <option value="Intermediate">Intermediate</option>
                <option value="Advanced">Advanced</option>
            </InputSelect>
            <ValidationMessage For="@(() => model.SkillLevel)" />
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Estimated Time </label>
        <div class="col-md-6">
            <InputText class="form-control" @bind-Value="model.EstimatedTime" />
        </div>
        <ValidationMessage For="@(() => model.EstimatedTime)" />
    </div>


    <div class="form-group">
        <button type="submit" class="btn btn-primary">Save</button>
        <a class="btn btn-light" href="/courses/">
            Cancel
        </a>
    </div>
</EditForm>
@code {

    [SupplyParameterFromForm]
    protected Course model { get; set; }

    protected List<Instrument> Instruments { get; set; }

    protected List<Instructor> Instructors { get; set; }

    //protected override void OnInitialized() => model ??= new();

    protected override async Task OnInitializedAsync()
    {
        if (model == null) // && string.IsNullOrEmpty(model.Title)
        {
            model = new Course();

            Instruments = EffizyService.GetInstruments();

            Instructors = EffizyService.GetInstructors();
            //string apiUrl = "https://localhost:7164/api/Courses/GetInstruments/";
            //Instruments = await Http.GetFromJsonAsync<List<Instrument>>(apiUrl);

            //apiUrl = "https://localhost:7164/api/Courses/GetInstructors/";
            //Instructors = await Http.GetFromJsonAsync<List<Instructor>>(apiUrl);
        }
    }

    protected async Task SaveCourse()
    {
        if (!string.IsNullOrEmpty(model.Title))
        {
            EffizyService.AddCourse(model);
            //string apiUrl = "https://localhost:7164/api/Courses/";
            //await Http.PostAsJsonAsync(apiUrl, model);
            Cancel();
        }
    }

    public void Cancel()
    {
        NavigationManager.NavigateTo("/courses/");
    }
}